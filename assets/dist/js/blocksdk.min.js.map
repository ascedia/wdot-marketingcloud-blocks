{"version":3,"sources":["blocksdk.js"],"names":["SDK","config","whitelistOverride","sslOverride","Array","isArray","undefined","onEditClose","this","handlers","_whitelistOverride","_sslOverride","_messageId","_messages","0","_readyToPost","_pendingMessages","_receiveMessage","bind","window","addEventListener","method","postMessage","origin","payload","prototype","execute","options","callback","success","_post","push","getContent","cb","getUserData","getView","setBlockEditorWidth","value","setCentralData","dataObj","setData","data","setSuperContent","content","triggerAuth","stack","iframe","style","className","appID","document","appendChild","userData","scope","indexOf","triggerAuth2","authInfo","createElement","state","height","position","left","visibility","src","width","body","join","_executePendingMessages","authURL","thisMessage","clientId","encodeURIComponent","redirectURL","top","parent","self","message","forEach","_validateOrigin","id","_parentOrigin","allowedDomains","i","optionalSsl","length","mcSubdomain","RegExp","test","_typeof","sfdc","BlockSDK","module","exports"],"mappings":"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","file":"blocksdk.min.js","sourcesContent":["/*\n * Copyright (c) 2018, salesforce.com, inc.\n * All rights reserved.\n * Licensed under the BSD 3-Clause license.\n * For full license text, see LICENSE.txt file in the repo root  or https://opensource.org/licenses/BSD-3-Clause\n */\n\nvar SDK = function (config, whitelistOverride, sslOverride) {\n\t// config has been added as the primary parameter\n\t// If it is provided ensure that the other paramaters are correctly assigned\n\t// for backwards compatibility\n\tif (Array.isArray(config)) {\n\t\twhitelistOverride = config;\n\t\tsslOverride = whitelistOverride;\n\t\tconfig = undefined;\n\t}\n\n\tif (config && config.onEditClose) {\n\t\tthis.handlers = {\n\t\t\tonEditClose: config.onEditClose\n\t\t};\n\t\tconfig.onEditClose = true;\n\t}\n\n\tthis._whitelistOverride = whitelistOverride;\n\tthis._sslOverride = sslOverride;\n\tthis._messageId = 1;\n\tthis._messages = {\n\t\t0: function () {}\n\t};\n\tthis._readyToPost = false;\n\tthis._pendingMessages = [];\n\tthis._receiveMessage = this._receiveMessage.bind(this);\n\n\twindow.addEventListener('message', this._receiveMessage, false);\n\n\twindow.parent.postMessage({\n\t\tmethod: 'handShake',\n\t\torigin: window.location.origin,\n\t\tpayload: config\n\t}, '*');\n};\n\nSDK.prototype.execute = function execute (method, options) {\n\toptions = options || {};\n\n\tvar self = this;\n\tvar payload = options.data;\n\tvar callback = options.success;\n\n\tif (!this._readyToPost) {\n\t\tthis._pendingMessages.push({\n\t\t\tmethod: method,\n\t\t\tpayload: payload,\n\t\t\tcallback: callback\n\t\t});\n\t} else {\n\t\tthis._post({\n\t\t\tmethod: method,\n\t\t\tpayload: payload\n\t\t}, callback);\n\t}\n};\n\nSDK.prototype.getCentralData = function (cb) {\n\tthis.execute('getCentralData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getContent = function (cb) {\n\tthis.execute('getContent', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getData = function (cb) {\n\tthis.execute('getData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getUserData = function (cb) {\n\tthis.execute('getUserData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getView = function (cb) {\n\tthis.execute('getView', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setBlockEditorWidth = function (value, cb) {\n\tthis.execute('setBlockEditorWidth', {\n\t\tdata: value,\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setCentralData = function (dataObj, cb) {\n\tthis.execute('setCentralData', {\n\t\tdata: dataObj,\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setContent = function (content, cb) {\n\tthis.execute('setContent', {\n\t\tdata: content,\n\t\tsuccess: cb});\n};\n\nSDK.prototype.setData = function (dataObj, cb) {\n\tthis.execute('setData', {\n\t\tdata: dataObj,\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setSuperContent = function (content, cb) {\n\tthis.execute('setSuperContent', {\n\t\tdata: content,\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.triggerAuth = function (appID) {\n\tthis.getUserData(function (userData) {\n\t\tvar stack = userData.stack;\n\t\tif (stack.indexOf('qa') === 0) {\n\t\t\tstack = stack.substring(3,5) + '.' + stack.substring(0,3);\n\t\t}\n\t\tvar iframe = document.createElement('IFRAME');\n\t\tiframe.src = 'https://mc.' + stack + '.exacttarget.com/cloud/tools/SSO.aspx?appId=' + appID + '&restToken=1&hub=1';\n\t\tiframe.style.width= '1px';\n\t\tiframe.style.height = '1px';\n\t\tiframe.style.position = 'absolute';\n\t\tiframe.style.top = '0';\n\t\tiframe.style.left = '0';\n\t\tiframe.style.visibility = 'hidden';\n\t\tiframe.className = 'authframe';\n\t\tdocument.body.appendChild(iframe);\n\t});\n};\n\nSDK.prototype.triggerAuth2 = function (authInfo) {\n\tvar iframe = document.createElement('IFRAME');\n\tvar scope = '';\n\tvar state = '';\n\tif(Array.isArray(authInfo.scope)) {\n\t\tscope = '&scope=' + authInfo.scope.join('%20');\n\t}\n\tif(authInfo.state) {\n\t\tstate = '&state=' + authInfo.state;\n\t}\n\tiframe.src = authInfo.authURL + (authInfo.authURL.endsWith('/') ? '':'/') + 'v2/authorize?response_type=code&client_id=' + authInfo.clientId + '&redirect_uri=' + encodeURIComponent(authInfo.redirectURL) + scope + state;\n\tiframe.style.width= '1px';\n\tiframe.style.height = '1px';\n\tiframe.style.position = 'absolute';\n\tiframe.style.top = '0';\n\tiframe.style.left = '0';\n\tiframe.style.visibility = 'hidden';\n\tiframe.className = 'authframe';\n\tdocument.body.appendChild(iframe);\n};\n\n/* Internal Methods */\n\nSDK.prototype._executePendingMessages = function _executePendingMessages () {\n\tvar self = this;\n\n\tthis._pendingMessages.forEach(function (thisMessage) {\n\t\tself.execute(thisMessage.method, {\n\t\t\tdata: thisMessage.payload,\n\t\t\tsuccess: thisMessage.callback\n\t\t});\n\t});\n\n\tthis._pendingMessages = [];\n};\n\nSDK.prototype._post = function _post (payload, callback) {\n\tthis._messages[this._messageId] = callback;\n\tpayload.id = this._messageId;\n\tthis._messageId += 1;\n\t// the actual postMessage always uses the validated origin\n\twindow.parent.postMessage(payload, this._parentOrigin);\n};\n\nSDK.prototype._receiveMessage = function _receiveMessage (message) {\n\tmessage = message || {};\n\tvar data = message.data || {};\n\n\tif (data.method === 'handShake') {\n\t\tif (this._validateOrigin(data.origin)) {\n\t\t\tthis._parentOrigin = data.origin;\n\t\t\tthis._readyToPost = true;\n\t\t\tthis._executePendingMessages();\n\t\t\treturn;\n\t\t}\n\t} else if (data.method === 'closeBlock') {\n\t\tif (this._validateOrigin(data.origin)) {\n\t\t\t// here execute the method before closing the  block editing\n\t\t\t//onEditClose();\n\t\t\tif (this.handlers && this.handlers.onEditClose) {\n\t\t\t\tthis.handlers.onEditClose();\n\t\t\t}\n\t\t\tthis.execute('blockReadyToClose');\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// if the message is not from the validated origin it gets ignored\n\tif (!this._parentOrigin || this._parentOrigin !== message.origin) {\n\t\treturn;\n\t}\n\t// when the message has been received, we execute its callback\n\t(this._messages[data.id || 0] || function () {})(data.payload);\n\tdelete this._messages[data.id];\n};\n\n// the custom block should verify it is being called from the marketing cloud\nSDK.prototype._validateOrigin = function _validateOrigin (origin) {\n\t// Make sure to escape periods since these strings are used in a regular expression\n\tvar allowedDomains = this._whitelistOverride || ['exacttarget\\\\.com', 'marketingcloudapps\\\\.com', 'blocktester\\\\.herokuapp\\\\.com'];\n\n\tfor (var i = 0; i < allowedDomains.length; i++) {\n\t\t// Makes the s optional in https\n\t\tvar optionalSsl = this._sslOverride ? '?' : '';\n\t\tvar mcSubdomain = allowedDomains[i] === 'exacttarget\\\\.com' ? 'mc\\\\.' : '';\n\t\tvar whitelistRegex = new RegExp('^https' + optionalSsl + '://' + mcSubdomain + '([a-zA-Z0-9-]+\\\\.)*' + allowedDomains[i] + '(:[0-9]+)?$', 'i');\n\n\t\tif (whitelistRegex.test(origin)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nif (typeof(window) === 'object') {\n\twindow.sfdc = window.sfdc || {};\n\twindow.sfdc.BlockSDK = SDK;\n}\nif (typeof(module) === 'object') {\n\tmodule.exports = SDK;\n}\n"]}