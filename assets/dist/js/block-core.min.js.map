{"version":3,"sources":["block-core.js"],"names":["fieldIds","errors","setFieldError","message","id","input","document","getElementById","errorEl","hasError","classList","toggle","textContent","style","display","setTimeout","data","forEach","apply","waitMs","el","value","initSdk","statusElId","statusEl","hasSdk","window","sfdc","BlockSDK","self","top","e","canInitSdk","sdk","initBlock","escapeHtml","config","defaults","_config$statusElId","buildEmailHtml","_config$validate","validate","debounceMs","_config$debounceMs","_config$showErrors","_config$resetBtnId","resetBtnId","showErrors","acc","getFormValues","syncToBlock","applyErrors","setContent","getData","merged","_objectSpread","setFormValues","fn","t","_this","this","_len","arguments","length","args","Array","_key","clearTimeout","resetBtn","addEventListener","setData","isValidHttpUrl","str","String","replace","url","URL","trim","protocol","_unused"],"mappings":"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","file":"block-core.min.js","sourcesContent":["(() => {\n  function inIframe() {\n    try {\n      return window.self !== window.top;\n    } catch (e) {\n      return true;\n    }\n  }\n\n  function escapeHtml(str) {\n    return String(str || \"\")\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\"/g, \"&quot;\")\n      .replace(/'/g, \"&#039;\");\n  }\n\n  function isValidHttpUrl(value) {\n    try {\n      const url = new URL(String(value || \"\").trim());\n      return url.protocol === \"http:\" || url.protocol === \"https:\";\n    } catch {\n      return false;\n    }\n  }\n\n  function setFieldError(id, message) {\n    const input = document.getElementById(id);\n    const errorEl = document.getElementById(id + \"Error\");\n    const hasError = !!message;\n    if (input) input.classList.toggle(\"is-invalid\", hasError);\n    if (errorEl) {\n      errorEl.textContent = message || \"\";\n      errorEl.style.display = hasError ? \"block\" : \"none\";\n    }\n  }\n\n  function applyErrors(fieldIds, errors) {\n    fieldIds.forEach((id) => setFieldError(id, errors[id]));\n  }\n\n  function debounce(fn, waitMs) {\n    let t;\n    return function (...args) {\n      clearTimeout(t);\n      t = setTimeout(() => fn.apply(this, args), waitMs);\n    };\n  }\n\n  function setFormValues(fieldIds, data) {\n    fieldIds.forEach((id) => {\n      const el = document.getElementById(id);\n      if (el) el.value = data[id] || \"\";\n    });\n  }\n\n  function getFormValues(fieldIds) {\n    return fieldIds.reduce((acc, id) => {\n      const el = document.getElementById(id);\n      acc[id] = el ? el.value : \"\";\n      return acc;\n    }, {});\n  }\n\n  function initSdk(statusElId) {\n    const statusEl = document.getElementById(statusElId);\n    const hasSdk = !!(window.sfdc && window.sfdc.BlockSDK);\n    const canInitSdk = hasSdk && inIframe();\n    const sdk = canInitSdk ? new window.sfdc.BlockSDK() : null;\n\n    if (!hasSdk) {\n      if (statusEl) statusEl.textContent = \"BlockSDK failed to load.\";\n    } else if (!sdk) {\n      if (statusEl) statusEl.textContent = \"Preview mode: SDK disabled.\";\n    } else if (statusEl) {\n      statusEl.textContent = \"\";\n    }\n\n    return sdk;\n  }\n\n  function initBlock(config) {\n    const {\n      fieldIds,\n      defaults,\n      buildEmailHtml,\n      validate = () => ({}),\n      debounceMs = 250,\n      statusElId = \"sdkStatus\",\n      resetBtnId = \"resetBtn\",\n      showErrors = true,\n    } = config;\n\n    const sdk = initSdk(statusElId);\n\n    function syncToBlock() {\n      const data = getFormValues(fieldIds);\n      const errors = validate(data);\n      if (showErrors) applyErrors(fieldIds, errors);\n      if (!sdk) return;\n      sdk.setData(data, function () {});\n      if (Object.keys(errors).length > 0) return;\n      sdk.setContent(buildEmailHtml(data), function () {});\n    }\n\n    if (sdk) {\n      sdk.getData((data) => {\n        const merged = { ...defaults, ...(data || {}) };\n        setFormValues(fieldIds, merged);\n        sdk.setData(merged);\n        sdk.setContent(buildEmailHtml(merged));\n      });\n    } else {\n      setFormValues(fieldIds, defaults);\n    }\n\n    fieldIds.forEach((id) => {\n      const el = document.getElementById(id);\n      if (el) el.addEventListener(\"input\", debounce(syncToBlock, debounceMs));\n    });\n\n    const resetBtn = document.getElementById(resetBtnId);\n    if (resetBtn) {\n      resetBtn.addEventListener(\"click\", () => {\n        setFormValues(fieldIds, defaults);\n        if (showErrors) applyErrors(fieldIds, {});\n        if (!sdk) return;\n        sdk.setData(defaults);\n        sdk.setContent(buildEmailHtml(defaults));\n      });\n    }\n  }\n\n  window.BlockCore = {\n    initBlock,\n    escapeHtml,\n    isValidHttpUrl,\n  };\n})();\n"]}